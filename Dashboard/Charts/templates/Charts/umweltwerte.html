{% extends 'Charts/index.html' %}

{% block content %}

<div class="container-fluid" style="background: #ffffff">
  <div class="row">
    <div class="col-12">
       <div id="time-selectors">
        {% comment %} <div class="time-selector active" id="1h" data-time="1h">1h</div>
        <div class="time-selector" id="4h" data-time="4h">4h</div> {% endcomment %}
        {% comment %} <div class="time-selector" id="1d" data-time="1D">1d</div> {% endcomment %}
       </div>
        {% comment %} <script>
         const timeSelectors = document.querySelectorAll('.time-selector');
            timeSelectors.forEach(selector => {
            selector.addEventListener('click', () => {
            timeSelectors.forEach(selector => {
            selector.classList.remove('active');
            });
         selector.classList.add('active');
         const selectedTime = selector.getAttribute('data-time');
         });
         });
       </script> {% endcomment %}
       <div class="border1">
         <h1>Temperatur</h1>
          <canvas id="temperatur"></canvas>
      </div>
    </div>
  </div>

  <div class="row">
  <div class="col-12">
      <div id="time-selectors2">
      {% comment %} <div class="time-selector active" id="1h" data-time="1h">1h</div>
      <div class="time-selector" id="4h" data-time="4h">4h</div> {% endcomment %}
      {% comment %} <div class="time-selector" id="1d" data-time="1D">1d</div> {% endcomment %}
      </div>
      {% comment %} <script>
          const timeSelectors = document.querySelectorAll('.time-selector2');
          timeSelectors.forEach(selector => {
          selector.addEventListener('click', () => {
          timeSelectors.forEach(selector => {
          selector.classList.remove('active');
          });
          selector.classList.add('active');
          const selectedTime = selector.getAttribute('data-time');
          });
          });
      </script> {% endcomment %}
      <div class="border1">
          <h1>Luftfeuchtigkeit</h1>
          <canvas id="feuchtigkeit"></canvas>
      </div>
  </div>
</div>

</div>
   
  

<script>

// create initial for "temperatur
var lastMinute = [];
var meineDaten = {{ room_temperature|safe }}

console.log(meineDaten)

for (var i = 0; i < 10; i++) {
    lastMinute.push(meineDaten[i]);
}
console.log(lastMinute)

var numberElements = 12;
var updateCount = 12;

let labels = [];
let now = new Date();

for (let i = 59; i >= 0; i--) {
    let time = new Date(now - i * 5000);
    labels.push(time.toLocaleTimeString());
    }

const options = {
    maintainAspectRatio: false,
    responsive: true,
    legend: {
      display: true,
    },
    legend: {
      display: false
    },
    scales: {
      x: {
        beginAtZero: true,
        drawBorder: false,
      },
      y: {
        beginAtZero: true,
        type: 'linear',
        grid: {
          drawBorder: false,
          color: (context) => {
          if(context.tick.value === 0) {
              return 'black'
          }
          } 
        },
        beginAtZero: false,
        suggestedMin: 0,
        suggestedMax: 0,
      }
    }
  };

var ctx_live = document.getElementById("temperatur");
var myChart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      data: lastMinute,
      borderWidth: 2,
      radius: 0,
      borderColor:'rgba(255, 99, 132, 1)',
      label: 'Raumtemperatur [Â°C]',
      tension: 0.25,
      //fill: {
      // target: 'origin',
        //below: 'rgba(255, 99, 132, 0.2)',
        //above: 'rgba(4, 216, 14, 0.2)'
      //}, 
    }]
  },
  options: options,
});


// logic to get new data for '1h' chart
var getData = function() {
  $.ajax({
    type: "GET",
    url: "/umweltwerte/get_temperatur_one_hour",
    success: function(data) {
        console.log(data)
       
        var _chartData = data[0]
        
        //const myFloat = parseFloat(_chartData.contr_Margin);

        var today = new Date();
        //if (document.getElementById('1h').classList.contains('active')) {
          var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        //} else {
        //  var time = today.getHours() + ":" + today.getMinutes();
        //}
        console.log(time)
        myChart.data.labels.push(time);
        myChart.data.datasets[0].data.push(_chartData);
  
          if (updateCount == numberElements){
              myChart.data.labels.shift();
              myChart.data.datasets[0].data.shift();
            }
          else updateCount++;
  
        myChart.update('none');
    }
  });
};


updateCanvas = setInterval(getData, 1000);





// create initial for "Luftfeuchtigkeit"
var lastMinute = [];
var meineDaten = {{ room_temperature|safe }}

console.log(meineDaten)

for (var i = 0; i < 10; i++) {
    lastMinute.push(meineDaten[i]);
}
console.log(lastMinute)

var numberElements = 12;
var updateCount = 12;

let labelsHumidity = [];
let nowHumidity = new Date();

for (let i = 59; i >= 0; i--) {
    let time = new Date(nowHumidity - i * 5000);
    labelsHumidity.push(time.toLocaleTimeString());
    }

const optionsHumidity = {
    maintainAspectRatio: false,
    responsive: true,
    legend: {
      display: true,
    },
    legend: {
      display: false
    },
    scales: {
      x: {
        beginAtZero: true,
        drawBorder: false,
      },
      y: {
        beginAtZero: true,
        type: 'linear',
        grid: {
          drawBorder: false,
          color: (context) => {
          if(context.tick.value === 0) {
              return 'black'
          }
          } 
        },
        beginAtZero: false,
        suggestedMin: 0,
        suggestedMax: 0,
      }
    }
  };

var ctx_live = document.getElementById("feuchtigkeit");
var myHumidtyChart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: labelsHumidity,
    datasets: [{
      data: lastMinute,
      borderWidth: 2,
      radius: 0,
      borderColor:'rgba(255, 99, 132, 1)',
      label: 'Luftfeuchtigkeit [%]',
      tension: 0.25,
      //fill: {
      // target: 'origin',
        //below: 'rgba(255, 99, 132, 0.2)',
        //above: 'rgba(4, 216, 14, 0.2)'
      //}, 
    }]
  },
  options: optionsHumidity,
});


// logic to get new data for '1h' chart
var getData = function() {
  $.ajax({
    type: "GET",
    url: "/umweltwerte/get_temperatur_one_hour",
    success: function(data) {
        console.log(data)
       
        var _chartDataHumidty = data[0]
        
        //const myFloat = parseFloat(_chartData.contr_Margin);

        var today = new Date();
        //if (document.getElementById('1h').classList.contains('active')) {
          var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        //} else {
        //  var time = today.getHours() + ":" + today.getMinutes();
        //}
        console.log(time)
        myHumidtyChart.data.labels.push(time);
        myHumidtyChart.data.datasets[0].data.push(_chartDataHumidty);
  
          if (updateCount == numberElements){
              myHumidtyChart.data.labels.shift();
              myHumidtyChart.data.datasets[0].data.shift();
            }
          else updateCount++;
  
        myHumidtyChart.update('none');
    }
  });
};


updateCanvas = setInterval(getData, 1000);

</script>



{% endblock %}