{% extends 'Charts/index.html' %}

{% block content %}

<div class="container-fluid" style="background: #ffffff">
  <div class="row">
    <div class="col-12">
       <div id="time-selectors">
        {% comment %} <div class="time-selector active" id="1h" data-time="1h">1h</div>
        <div class="time-selector" id="4h" data-time="4h">4h</div> {% endcomment %}
        {% comment %} <div class="time-selector" id="1d" data-time="1D">1d</div> {% endcomment %}
       </div>
        <script>
        // JavaScript-Code für die Zeit-Auswahl-Elemente
         //const timeSelectors = document.querySelectorAll('.time-selector');
          //selector.addEventListener('click', () => {
            //timeSelectors.forEach(selector => {
            //selector.classList.remove('active');
            //});
         //selector.classList.add('active');
         //const selectedTime = selector.getAttribute('data-time');
        // });
         //});
       </script>
       <div class="border1">
         <h1>Energieverbrauch</h1>
          <canvas id="EnergieConsumption"></canvas>
      </div>
    </div>
  </div>
</div>
   
  
<script>
// Initialisierung des Diagramms Energieverbrauch
var lastHourOfEnergyConsumption = [];
var energyConsumption = {{ energy_consumption|safe }}
var energyConsumptionTime = {{ energy_consumption_time|safe }}

console.log(energyConsumption)
console.log(energyConsumptionTime)

for (var i = 0; i < 120; i++) {
    lastHourOfEnergyConsumption.push(energyConsumption[0]);
}

var numberElements = 12;
var updateCount = 12;

let labels = [];
let now = new Date();

// Erstellen der x-Achsen-Labels basierend auf den letzten 60 Minuten
for (let i = 1439; i >= 0; i--) {
  let time = new Date(now - i * 60000);
  labels.push(time.toLocaleTimeString());
}

const options = {
  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
    }
  }
};

var ctx_live = document.getElementById("EnergieConsumption");
var energieConsumptionChart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: energyConsumptionTime,
    datasets: [{
      data: energyConsumption,
      borderWidth: 2,
      radius: 0,
      borderColor:'rgba(255, 99, 132, 1)',
      label: 'Energieverbrauch [%] - Betrachtungszeitraum: 1 Stunde',
      tension: 0.25,
      //fill: {
      // target: 'origin',
        //below: 'rgba(255, 99, 132, 0.2)',
        //above: 'rgba(4, 216, 14, 0.2)'
      //}, 
    }]
  },
  options: options,
});




// Logik zum Abrufen neuer Daten für das '1h'-Diagramm Energiebrauch
var getData = function() {
  $.ajax({
    type: "GET",
    url: "/energiewerte/get_energy_consumption_one_hour",
    success: function(data) {
        var _data = data;

        var now = new Date();
        var time = now.toLocaleTimeString();
        
        energieConsumptionChart.data.labels.push(time);
        energieConsumptionChart.data.datasets[0].data.push(_data);

        // Begrenzung der Datenpunkte auf die letzten 60 Minute
        if (updateCount == 60) {
          energieConsumptionChart.data.labels.shift();
          energieConsumptionChart.data.datasets[0].data.shift();
        } else {
          updateCount++;
        }

        energieConsumptionChart.update('none');
    }
  });
};

// Intervall für das Aktualisieren der Daten alle 5 Sekunden
//updateCanvas = setInterval(getData, 5000);

</script>

{% endblock %}