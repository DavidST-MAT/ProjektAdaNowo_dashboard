{% extends 'Charts/index.html' %}

{% block content %}

<div class="container-fluid" style="background: #ffffff">

  <div class="row">

    <div class="col-md-4" data-row-id="row1">
      <div class="border1">
        <h1>Nonwoven Unevenness          
          <select id="dropdownNonwoven">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('Nonwoven')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="NonwovenUnevenness"></canvas>
      </div>
    </div>

    <div class="col-md-4" data-row-id="row2">
      <div class="border1">
        <h1>Card Floor Evenness 
          <select id="dropdownCardFloorEveness">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('CardFloorEvenness')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="CardFloorEvenness"></canvas>
      </div>
    </div>

    <div class="col-md-4" data-row-id="row3">
      <div class="border1">
        <h1>Ambient Temperature
            <select id="dropdownAmbientTemperature">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('AmbientTemperature')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="AmbientTemperature"></canvas>
      </div>
    </div>

  </div>

  <div class="row">

    <div class="col-8">
      <div class="border1">
        <h1>Laboratory Values
          <select id="dropdownLaboratoryValues">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('LaboratoryValues')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="LabValues"></canvas>
      </div>
    </div>

    <div class="col-4">
      <div class="border1">
        <h1>Humidity Environment
          <select id="dropdownHumidityEnvironment">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('HumidityEnvironment')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="HumidityEnvironment"></canvas>
      </div>
    </div>

  </div>


  <div class="row">

    <div class="col-8">
      <div class="border1">
        <h1>Economics
          <select id="dropdownEconomics">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('Economics')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="Economics"></canvas>
      </div>
    </div>
 
    <div class="col-4">
      <div class="border1">
        <h1>Line Power Consumption
          <select id="dropdownLinePowerConsumption">
            <option value="1h">1h</option>
            <option value="3h">3h</option>
            <option value="6h">6h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <button onclick="resetZoomChart('LinePowerConsumption')" class="small-button">
              <i class="fa-solid fa-rotate-left"></i>
          </button>
        </h1>
        <canvas id="LinePowerConsumption"></canvas>
      </div>
    </div>

  </div>

</div>


<script>

var time_select = {
  '1h': 1,
  '3h': 3,
  '6h': 6,
  '12h': 12,
  '1d': 24,
  '7d': 168,
  '30d': 720
  }

document.getElementById("dropdownNonwoven").addEventListener("change", function() {
    sendDataToBackend("NonwovenUnevennes", this.value);   
});

document.getElementById("dropdownCardFloorEveness").addEventListener("change", function() {
    sendDataToBackend("CardFloorEvenness", this.value);   
});

document.getElementById("dropdownAmbientTemperature").addEventListener("change", function() {
    sendDataToBackend("AmbientTemperature", this.value);  
});

document.getElementById("dropdownLaboratoryValues").addEventListener("change", function() {
    sendDataToBackend("LaboratoryValues", this.value);  
});

document.getElementById("dropdownHumidityEnvironment").addEventListener("change", function() {
    sendDataToBackend("HumidityEnvironment", this.value);  
});

document.getElementById("dropdownEconomics").addEventListener("change", function() {
    sendDataToBackend("Economics", this.value);  
});

document.getElementById("dropdownLinePowerConsumption").addEventListener("change", function() {
    sendDataToBackend("LinePowerConsumption", this.value);  
});


/// ?
function populate_empty_chart(selectedValue) {
  for (let i = time_select[selectedValue] * 60; i >= 0; i--) {
    nonwoven_uvenness.push(0);
  }
  let time_now = new Date();
  for (let i = time_select[selectedValue] * 60; i >= 0; i--) {
    let time = new Date(time_now - i * 60000);
    nonwoven_uvenness_time.push(time.toLocaleTimeString());
  }
}


// sending chart name and time selection to backend and get new data
function sendDataToBackend(headerOfChart, dropdown_time) {

    var data = {
        timeRange: dropdown_time,
        header: headerOfChart
    };

    $.ajax({
            type: "GET",
            url: '/Adanowo/update/',
            data: data,
            dataType: "json",
            success: function(response) {
                console.log('Antwort vom Server:', response);

                if (data["header"] === "NonwovenUnevennes") {
                  nonwoven_uvenness = response["timeRange"][0]
                  nonwoven_uvenness_time = response["timeRange"][1]
                  nonwoven_unevenness_chart.data.labels = nonwoven_uvenness_time
                  nonwoven_unevenness_chart.data.datasets[0].data = nonwoven_uvenness;
                  nonwoven_unevenness_chart.update();
                }
                else if (data["header"] === "CardFloorEvenness") {
                  card_floor_evenness = response["timeRange"][0]
                  card_floor_evenness_time = response["timeRange"][1]                
                  card_floor_evenness_chart.data.labels = card_floor_evenness_time
                  card_floor_evenness_chart.data.datasets[0].data = card_floor_evenness;
                  card_floor_evenness_chart.update();
                }
                else if (data["header"] === "AmbientTemperature") {
                  ambient_temperature = response["timeRange"][0]
                  ambient_temperature_time = response["timeRange"][1]                
                  ambient_temperature_chart.data.labels = ambient_temperature_time
                  ambient_temperature_chart.data.datasets[0].data = ambient_temperature;
                  ambient_temperature_chart.update();
                }
                else if (data["header"] === "LaboratoryValues") {
                  area_weights = response["timeRange"][0][0]
                  tensile_force_md_all = response["timeRange"][0][1]
                  tensile_force_cd_all = response["timeRange"][0][2]
                  laboratory_values_time = response["timeRange"][1]                
                  laboratory_values_chart.data.labels = laboratory_values_time
                  laboratory_values_chart.data.datasets[0].data = area_weights;
                  laboratory_values_chart.data.datasets[1].data = tensile_force_md_all
                  laboratory_values_chart.data.datasets[2].data = tensile_force_cd_all
                  //laboratory_values_chart.data.datasets[3].data[2] = tensile_force_md_all[1];
                  //laboratory_values_chart.data.datasets[4].data[2] = tensile_force_md_all[2];
                  //laboratory_values_chart.data.datasets[5].data[2] = tensile_force_md_all[3];
                  //laboratory_values_chart.data.datasets[6].data[3] = tensile_force_cd_all[1];
                  //laboratory_values_chart.data.datasets[7].data[3] = tensile_force_cd_all[2];
                  //laboratory_values_chart.data.datasets[8].data[3] = tensile_force_cd_all[3];
                  laboratory_values_chart.update();
                }
                else if (data["header"] === "HumidityEnvironment") {
                  humidity_environment = response["timeRange"][0]
                  humidity_environment_time = response["timeRange"][1]                
                  humidity_environment_chart.data.labels = humidity_environment_time
                  humidity_environment_chart.data.datasets[0].data = humidity_environment;
                  humidity_environment_chart.update();
                }
                else if (data["header"] === "Economics") {
                  economics = response["timeRange"][0][0]
                  material_costs = response["timeRange"][0][1]
                  contribution_margin = response["timeRange"][0][2]
                  production_income = response["timeRange"][0][3]
                  economics_time = response["timeRange"][1]                
                  economics_chart.data.labels = economics_time
                  economics_chart.data.datasets[0].data = economics;
                  economics_chart.data.datasets[1].data = material_costs;
                  economics_chart.data.datasets[2].data = contribution_margin;
                  economics_chart.data.datasets[3].data = production_income;
                  economics_chart.update();
                }
                else if (data["header"] === "LinePowerConsumption") {
                  line_power_consumption = response["timeRange"][0]
                  line_power_consumption_time = response["timeRange"][1]                
                  line_power_consumption_chart.data.labels = line_power_consumption_time
                  line_power_consumption_chart.data.datasets[0].data = line_power_consumption;
                  line_power_consumption_chart.update();
                }

            },
            error: function(xhr, status, error) {
                console.error('Fehler beim Senden der Anfrage:', error);
            }
        });
}


////////////////////////////////////////////////////////////////////////////////////////

/// create initial chart nonwoven_unevenness ///
var nonwoven_uvenness = {{ nonwoven_uvenness|safe }}
var nonwoven_uvenness_time = {{ nonwoven_uvenness_time|safe }}

const options_nonwoven_uvenness = {
  plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },

  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
          if(context.tick.value === 0) {
              return 'black'
          }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[quantity]', 
        font: {
          size: 12, 
        },
      },
    }
  }
};

var ctx_live = document.getElementById("NonwovenUnevenness");
var nonwoven_unevenness_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: nonwoven_uvenness_time,
    datasets: [{
      data: nonwoven_uvenness,
      borderWidth: 2,
      radius: 2,
      borderColor: 'rgba(54, 162, 235, 1)',
      label: 'Nonwoven Unevenness',
      tension: 0.25,
      fill: {
       target: 'origin',
        //below: 'rgba(54, 162, 235, 0.8)',
        above: 'rgba(54, 162, 235, 0.1)'
      }, 
    }]
  },
  options: options_nonwoven_uvenness,
});


///////////////////////////////////////////////////////////////////////////////////////////////

// create initial chart Energieverbrauch
var card_floor_evenness = {{ card_floor_evenness|safe }}
var card_floor_evenness_time = {{ nonwoven_uvenness_time|safe }}

const options_card_floor_evenness = {
  plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },

  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: 'quantity', 
        font: {
          size: 12, 
        },
        position: 'top',
      },
    }
  }
};

var ctx_live = document.getElementById("CardFloorEvenness");
var card_floor_evenness_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: card_floor_evenness_time,
    datasets: [{
      data: card_floor_evenness,
      borderWidth: 2,
      radius: 2,
      borderColor: 'rgba(0, 128, 0, 1)',
      label: 'Card Floor Evenness',
      tension: 0.25,
      fill: {
       target: 'origin',
        below: 'rgba(0, 128, 0, 0.1)',
        above: 'rgba(0, 128, 0, 0.1)'
      }, 
    }]
  },
  options: options_card_floor_evenness,
});


///////////////////////////////////////////////////////////////////////////////////////////////

// create initial chart Ambient Temperature
var ambient_temperature = {{ ambient_temperature|safe }}
var ambient_temperature_time = {{ ambient_temperature_time|safe }}

const options3 = {
  plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },
  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[Â°C]', 
        font: {
          size: 12, 
        },
        position: 'top',
      },
    }
  }
};

var ctx_live = document.getElementById("AmbientTemperature");
var ambient_temperature_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: ambient_temperature_time,
    datasets: [{
      data: ambient_temperature,
      borderWidth: 2,
      radius: 2,
      borderColor: 'rgba(255, 0, 0, 1)',
      label: 'Temperature',
      tension: 0.25,
      fill: {
       target: 'origin',
       below: 'rgba(255, 0, 0, 0.1)',
       above: 'rgba(255, 0, 0, 0.1)'
      }, 
    }]
  },
  options: options3,
});


///////////////////////////////////////////////////////////////////////////////////////////////

// create initial chart LaborWerte
var laboratory_values_time = {{ laboratory_values_time|safe }} 
var area_weights = {{ area_weights|safe }}
var tensile_force_md_all = {{ tensile_force_md_all|safe }}
var tensile_force_cd_all = {{ tensile_force_cd_all|safe }}

const options5 = {
  plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },

  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      position: 'right',
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[g/m^2]', 
        font: {
          size: 12, 
        },
      },
    },
    y2: {
      position: 'left',
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[N]', 
        font: {
          size: 12, 
        },
      },
    }
  }
};

var ctx_live = document.getElementById("LabValues");
var laboratory_values_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: laboratory_values_time,
    datasets: [
    {
      data: area_weights,
      borderWidth: 2,
      radius: 0,
      borderColor: 'rgba(0, 0, 255, 1)',
      label: 'Area Weight Median',
      tension: 0.25,
    },
    {
      data: tensile_force_cd_all,
      borderWidth: 2,
      radius: 0,
      borderColor: 'rgba(255, 180, 100, 1)', 
      label: 'Tensile Strength CD Median',
      tension: 0.25,
      yAxisID: 'y2', 
    },
    {
      data: tensile_force_cd_all,
      borderWidth: 2,
      radius: 0,
      borderColor: 'rgba(255, 128, 128, 1)', 
      label: 'Tensile Strength CD Median',
      tension: 0.25,
      yAxisID: 'y2',
    },
    ]
  },
  options: options5,
});


///////////////////////////////////////////////////////////////////////////////////////////////

// create initial chart Ambient Temperature
var humidity_environment = {{ humidity_environment|safe }}
var humidity_environment_time = {{ humidity_environment_time|safe }}

const options4 = {
  plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },

  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[%]', 
        font: {
          size: 12, 
        },
        position: 'bottom',
      },
    }
  }
};

var ctx_live = document.getElementById("HumidityEnvironment");
var humidity_environment_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: humidity_environment_time,
    datasets: [{
      data: humidity_environment,
      borderWidth: 2,
      radius: 2,
      borderColor:'rgba(255, 99, 132, 1)',
      label: 'Humidity',
      tension: 0.25,
      fill: {
        target: 'origin',
        below: 'rgba(255, 99, 132, 0.1)',
        above: 'rgba(255, 99, 132, 0.1)'
      }, 
    }]
  },
  options: options4,
});


////////////////////////////////////////////////////////////////////

// create initial chart Economics
var energy_costs = {{ energy_costs|safe }}
var economics_time = {{ energy_costs_time|safe }}
var material_costs = {{ material_costs|safe }}
var contribution_margin = {{ contribution_margin|safe }}
var production_income = {{ production_income|safe }}

const options_economics = {
    plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },
  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[EUR]', 
        font: {
          size: 12, 
        },
        position: 'bottom',
      },
    },
    
  }
};

var ctx_live = document.getElementById("Economics");
var economics_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: economics_time,
    datasets: [{
      data: energy_costs,
      borderWidth: 2,
      radius: 0,
      borderColor:'rgba(155, 99, 132, 1)',
      label: 'Energy Costs',
      tension: 0.25,
      //fill: {
      // target: 'origin',
        //below: 'rgba(255, 99, 132, 0.2)',
        //above: 'rgba(4, 216, 14, 0.2)'
      //}, 
    },
    {
      data: material_costs,
      borderWidth: 2,
      radius: 0,
      borderColor: 'rgba(4, 216, 14, 1)',
      label: 'Material Costs',
      tension: 0.25,
    },
    {
      data: contribution_margin,
      borderWidth: 2,
      radius: 0,
      borderColor: 'rgba(77, 77, 77, 1)',
      label: 'Contribution Margin',
      tension: 0.25,
    },
    {
      data: production_income,
      borderWidth: 2,
      radius: 0,
      borderColor: 'rgba(255, 0, 255, 1)',
      label: 'Production Income',
      tension: 0.25,
    }
    ]  
  },
  options: options_economics,
});


////////////////////////////////////////////////////////////////////

// create initial chart Line Power Consumption
var line_power_consumption = {{ line_power_consumption|safe }}
var line_power_consumption_time = {{ line_power_consumption_time|safe }}

const options_line_power_consumption = {
  plugins: {
    zoom: {
      zoom: {
        wheel: {
          enabled: true,
        },
        drag: {
          enabled: true,
          backgroundColor: 'rgba(255,0,0,0.3)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        mode: 'x'
      },
    }
  },

  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[kW]', 
        font: {
          size: 12, 
        },
        position: 'bottom',
      },
    }
  }
};

var ctx_live = document.getElementById("LinePowerConsumption");
var line_power_consumption_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: line_power_consumption_time,
    datasets: [{
      data: line_power_consumption,
      borderWidth: 2,
      radius: 2,
      borderColor:'rgba(122, 22, 12, 1)',
      label: 'Energy Consumption',
      tension: 0.25,
      fill: {
        target: 'origin',
        below: 'rgba(122, 22, 12, 0.1)',
        above: 'rgba(122, 22, 12, 0.1)'
      }, 
    }]
  },
  options: options_line_power_consumption,
});


////////////////////////////////////////////////////////////////////

/// updating Nonwoven Environment ///
var updating_nonenwoven_unevenness = function() {

  $.ajax({
    type: "GET",
    url: "/Charts/update_nonwoven_unevenness_chart",
    success: function(data) {

      var _nonwoven_unevenness=data["NonwovenUnevenness"];
      var _nonwoven_unevenness_time=data["NonwovenUnevennessTime"];

      var date = new Date(_nonwoven_unevenness_time);

      if (/^\d{2}:\d{2}$/.test(nonwoven_unevenness_chart.data.labels[0])) {
        var hours = date.getUTCHours().toString().padStart(2, '0');
        var minutes = date.getUTCMinutes().toString().padStart(2, '0');
        var time =  `${hours}:${minutes}`;
      }
      else {
        var day = date.getUTCDate().toString();
        var month = (date.getUTCMonth() + 1).toString(2, '0'); // Months are 0-based
        var hours = date.getUTCHours().toString().padStart(2, '0');
        var minutes = date.getUTCMinutes().toString().padStart(2, '0');
        var time = `${day}-${month} ${hours}:${minutes}`;
      }

      nonwoven_unevenness_chart.data.labels.push(time);
      nonwoven_unevenness_chart.data.datasets[0].data.push(_nonwoven_unevenness);

      nonwoven_unevenness_chart.data.labels.shift();
      nonwoven_unevenness_chart.data.datasets[0].data.shift();
      nonwoven_unevenness_chart.update('none');
    }
  });
};


/// updating Card Floor Evenness ///
var updating_card_floor_evenness = function() {

  $.ajax({
    type: "GET",
    url: "/Charts/update_card_floor_evenness_chart",
    success: function(data) {
  
      var _card_floor_evenness=data["CardFloorEvenness"];
  
      var now = new Date();


      if (/^\d{2}:\d{2}:\d{2}$/.test(card_floor_evenness_chart.data.labels[0])) {
        var time = now.toLocaleTimeString();
      }
      else {
        var day = String(now.getDate()).padStart(2, '0'); 
        var month = String(now.getMonth() + 1).padStart(2, '0'); 
        var hour = String(now.getHours()).padStart(2, '0'); 
        var minute = String(now.getMinutes()).padStart(2, '0'); 
        var time = `${day}-${month} ${hour}:${minute}`;
      }

      // Updating AmbientTemperature
      card_floor_evenness_chart.data.labels.push(time);
      card_floor_evenness_chart.data.datasets[0].data.push(_card_floor_evenness);
      card_floor_evenness_chart.data.labels.shift();
      card_floor_evenness_chart.data.datasets[0].data.shift();
      card_floor_evenness_chart.update('none');
    }
  });
};


/// updating Ambient Temperature ///
var updating_ambient_temperature = function() {

  $.ajax({
    type: "GET",
    url: "/Charts/update_ambient_temperature_chart",
    success: function(data) {
  
      var _ambient_temperature=data["AmbientTemperature"];
  
      var now = new Date();

      if (/^\d{2}:\d{2}:\d{2}$/.test(ambient_temperature_chart.data.labels[0])) {
        var time = now.toLocaleTimeString();
      }
      else {
        var day = String(now.getDate()).padStart(2, '0'); 
        var month = String(now.getMonth() + 1).padStart(2, '0'); 
        var hour = String(now.getHours()).padStart(2, '0'); 
        var minute = String(now.getMinutes()).padStart(2, '0'); 
        var time = `${day}-${month} ${hour}:${minute}`;
      }

      ambient_temperature_chart.data.labels.push(time);
      ambient_temperature_chart.data.datasets[0].data.push(_ambient_temperature);
      ambient_temperature_chart.data.labels.shift();
      ambient_temperature_chart.data.datasets[0].data.shift();
      ambient_temperature_chart.update('none');
    }
  });
};


/// updating laboratory values ///
var updating_laboratory_values = function() {
    $.ajax({
      type: "GET",
      url: "/Charts/update_laboratory_values_chart",
      success: function(data) {

        //var _area_weight_min=data["AreaWeightMin"];
        var _area_weight_med=data["AreaWeightMed"];
        //var _area_weight_max=data["AreaWeightMax"];

        //var _tensile_strength_min_cd = data["TensileStrengthMinCD"]
        var _tensile_strength_med_cd = data["TensileStrengthMedCD"]
        //var _tensile_strength_max_cd = data["TensileStrengthMaxCD"]

        //var _tensile_strength_min_md = data["TensileStrengthMinMD"]
        var _tensile_strength_med_md = data["TensileStrengthMedMD"]
        //var _tensile_strength_max_md = data["TensileStrengthMaxMD"]


        var now = new Date();

        if (/^\d{2}:\d{2}:\d{2}$/.test(laboratory_values_chart.data.labels[0])) {
          var time = now.toLocaleTimeString();
        }
        else {
          var day = String(now.getDate()).padStart(2, '0'); 
          var month = String(now.getMonth() + 1).padStart(2, '0'); 
          var hour = String(now.getHours()).padStart(2, '0'); 
          var minute = String(now.getMinutes()).padStart(2, '0'); 
          var time = `${day}-${month} ${hour}:${minute}`;
        }


        laboratory_values_chart.data.labels.push(time);
        //laboratory_values_chart.data.datasets[0].data.push(_area_weight_min);
        laboratory_values_chart.data.datasets[0].data.push(_area_weight_med);
        //laboratory_values_chart.data.datasets[2].data.push(_area_weight_max);

        //laboratory_values_chart.data.datasets[3].data.push(_tensile_strength_min_cd);
        laboratory_values_chart.data.datasets[1].data.push(_tensile_strength_med_cd);
        //laboratory_values_chart.data.datasets[5].data.push(_tensile_strength_max_cd);

        //laboratory_values_chart.data.datasets[6].data.push(_tensile_strength_min_md);
        laboratory_values_chart.data.datasets[2].data.push(_tensile_strength_med_md);
        //laboratory_values_chart.data.datasets[8].data.push(_tensile_strength_max_md);

        laboratory_values_chart.data.labels.shift();
        laboratory_values_chart.data.datasets[0].data.shift();
        laboratory_values_chart.data.datasets[1].data.shift();
        laboratory_values_chart.data.datasets[2].data.shift();
        //laboratory_values_chart.data.datasets[3].data.shift();
        //laboratory_values_chart.data.datasets[4].data.shift();
        //laboratory_values_chart.data.datasets[5].data.shift();
        //laboratory_values_chart.data.datasets[6].data.shift();
        //laboratory_values_chart.data.datasets[7].data.shift();
        //laboratory_values_chart.data.datasets[8].data.shift();
        laboratory_values_chart.update('none');
    }
  });
}

/// updating Humidty Environment ///
var updating_humidity_environment = function() {

  $.ajax({
    type: "GET",
    url: "/Charts/update_humidity_environment_chart",
    success: function(data) {
  
      var _humidity_environment=data["HumidityEnvironment"];
  
      var now = new Date();

      if (/^\d{2}:\d{2}:\d{2}$/.test(humidity_environment_chart.data.labels[0])) {
        var time = now.toLocaleTimeString();
      }
      else {
        var day = String(now.getDate()).padStart(2, '0'); 
        var month = String(now.getMonth() + 1).padStart(2, '0'); 
        var hour = String(now.getHours()).padStart(2, '0'); 
        var minute = String(now.getMinutes()).padStart(2, '0'); 
        var time = `${day}-${month} ${hour}:${minute}`;
      }

      // Updating AmbientTemperature
      humidity_environment_chart.data.labels.push(time);
      humidity_environment_chart.data.datasets[0].data.push(_humidity_environment);
      humidity_environment_chart.data.labels.shift();
      humidity_environment_chart.data.datasets[0].data.shift();
      humidity_environment_chart.update('none');

    }
  });
};

/// updating economics ///
var updating_economics = function() {

  $.ajax({
    type: "GET",
    url: "/Charts/update_economics_chart",
    success: function(data) {
  
      var _energy_costs=data["EnergyCosts"];
      var _material_costs=data["MaterialCosts"];
      var _contribution_margin=data["ContributionMargin"];
      var _production_income=data["ProductionIncome"];
       
      var now = new Date();

      if (/^\d{2}:\d{2}:\d{2}$/.test(economics_chart.data.labels[0])) {
        var time = now.toLocaleTimeString();
      }
      else {
        var day = String(now.getDate()).padStart(2, '0'); 
        var month = String(now.getMonth() + 1).padStart(2, '0'); 
        var hour = String(now.getHours()).padStart(2, '0'); 
        var minute = String(now.getMinutes()).padStart(2, '0'); 
        var time = `${day}-${month} ${hour}:${minute}`;
      }


      // Updating AmbientTemperature
      economics_chart.data.labels.push(time);
      economics_chart.data.datasets[0].data.push(_energy_costs);
      economics_chart.data.datasets[1].data.push(_material_costs);
      economics_chart.data.datasets[2].data.push(_contribution_margin);
      economics_chart.data.datasets[3].data.push(_production_income);

      economics_chart.data.labels.shift();
      economics_chart.data.datasets[0].data.shift();
      economics_chart.data.datasets[1].data.shift();
      economics_chart.data.datasets[2].data.shift();
      economics_chart.data.datasets[3].data.shift();

      economics_chart.update('none');

    }
  });


}

/// updating line power consumption///
var updating_line_power_consumption = function() {

  $.ajax({
    type: "GET",
    url: "/Charts/update_line_power_consumption_chart",
    success: function(data) {
  
      var _line_power_consumption=data["LinePowerConsumption"];
  
      var now = new Date();

      if (/^\d{2}:\d{2}:\d{2}$/.test(line_power_consumption_chart.data.labels[0])) {
        var time = now.toLocaleTimeString();
      }
      else {
        var day = String(now.getDate()).padStart(2, '0'); 
        var month = String(now.getMonth() + 1).padStart(2, '0'); 
        var hour = String(now.getHours()).padStart(2, '0'); 
        var minute = String(now.getMinutes()).padStart(2, '0'); 
        var time = `${day}-${month} ${hour}:${minute}`;
      }

      // Updating AmbientTemperature
      line_power_consumption_chart.data.labels.push(time);
      line_power_consumption_chart.data.datasets[0].data.push(_line_power_consumption);
      line_power_consumption_chart.data.labels.shift();
      line_power_consumption_chart.data.datasets[0].data.shift();
      line_power_consumption_chart.update('none');

    }
  });
};


// Start the updating functions
update_nonenwoven_unevenness = setInterval(updating_nonenwoven_unevenness, 60000);
//update_card_floor_evenness = setInterval(updating_card_floor_evenness, 60000);
//update_ambient_temperature = setInterval(updating_ambient_temperature, 60000);
//update_laboratory_values = setInterval(updating_laboratory_values, 60000);
//update_humidity_environment = setInterval(updating_humidity_environment, 60000);
//update_economics = setInterval(updating_economics, 60000);
//update_line_power_consumption = setInterval(updating_line_power_consumption, 60000);


// Set new updating interval for selecting different time
// Updating nonwoven unevenness
document.getElementById("dropdownNonwoven").addEventListener("change", function() {
  clearInterval(update_nonenwoven_unevenness);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_nonenwoven_unevenness = setInterval(updating_nonenwoven_unevenness, 60000);
  }
  else if (selectedValue === "1d") {
    update_nonenwoven_unevenness = setInterval(updating_nonenwoven_unevenness, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_nonenwoven_unevenness = setInterval(updating_nonenwoven_unevenness, 3600000);
  }
});

// Updating card floor evenness
document.getElementById("dropdownCardFloorEveness").addEventListener("change", function() {
  clearInterval(update_card_floor_evenness);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_card_floor_evenness = setInterval(updating_card_floor_evenness, 60000);
  }
  else if (selectedValue === "1d") {
    update_card_floor_evenness = setInterval(updating_card_floor_evenness, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_card_floor_evenness = setInterval(updating_card_floor_evenness, 3600000);
  }
});

// Updating ambient temperature
document.getElementById("dropdownAmbientTemperature").addEventListener("change", function() {
  clearInterval(update_ambient_temperature);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_ambient_temperature = setInterval(updating_ambient_temperature, 60000);
  }
  else if (selectedValue === "1d") {
    update_ambient_temperature = setInterval(updating_ambient_temperature, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_ambient_temperature = setInterval(updating_ambient_temperature, 3600000);
  }
});

// updating laboratory values
document.getElementById("dropdownLaboratoryValues").addEventListener("change", function() {
  clearInterval(update_laboratory_values);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_laboratory_values = setInterval(updating_laboratory_values, 60000);
  }
  else if (selectedValue === "1d") {
    update_laboratory_values = setInterval(updating_laboratory_values, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_laboratory_values = setInterval(updating_laboratory_values, 3600000);
  }
});

// Updating humidtiy environment
document.getElementById("dropdownHumidityEnvironment").addEventListener("change", function() {
  clearInterval(update_humidity_environment);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_humidity_environment = setInterval(updating_humidity_environment, 60000);
  }
  else if (selectedValue === "1d") {
    update_humidity_environment = setInterval(updating_humidity_environment, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_humidity_environment = setInterval(updating_humidity_environment, 3600000);
  }
});

// Updating economics
document.getElementById("dropdownEconomics").addEventListener("change", function() {
  clearInterval(update_economics);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_economics = setInterval(updating_economics, 60000);
  }
  else if (selectedValue === "1d") {
    update_economics = setInterval(updating_economics, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_economics = setInterval(updating_economics, 3600000);
  }
});

// Updating line power consumption
document.getElementById("dropdownLinePowerConsumption").addEventListener("change", function() {
  clearInterval(update_line_power_consumption);

  let selectedValue = this.value;

  if (selectedValue === "1h" || selectedValue === "3h" || selectedValue === "6h" || selectedValue === "12h") {
    update_line_power_consumption = setInterval(updating_line_power_consumption, 60000);
  }
  else if (selectedValue === "1d") {
    update_line_power_consumption = setInterval(updating_line_power_consumption, 600000);
  }
  else if (selectedValue === "7d" || selectedValue === "30d") {
    update_line_power_consumption = setInterval(updating_line_power_consumption, 3600000);
  }
});


window.addEventListener('beforeunload', function() {
    clearInterval(update_nonenwoven_unevenness);
    clearInterval(update_nonenwoven_unevenness);
    clearInterval(update_ambient_temperature);
    clearInterval(update_laboratory_values);
    clearInterval(update_humidity_environment);
    clearInterval(update_economics);
    clearInterval(update_line_power_consumption);
});



function resetZoomChart(chartZoom) {
  if (chartZoom === "Nonwoven") {
    nonwoven_unevenness_chart.resetZoom();
  }
  else if (chartZoom === "CardFloorEvenness") {
    card_floor_evenness_chart.resetZoom();
  }
  else if (chartZoom === "AmbientTemperature") {
    ambient_temperature_chart.resetZoom();
  }
  else if (chartZoom === "LaboratoryValues") {
    laboratory_values_chart.resetZoom();
  }
  else if (chartZoom === "HumidityEnvironment") {
    humidity_environment_chart.resetZoom();
  }
  else if (chartZoom === "Economics") {
    economics_chart.resetZoom();
  }
  else if (chartZoom === "LinePowerConsumption") {
    line_power_consumption_chart.resetZoom();
  }
}

</script>

{% endblock %}