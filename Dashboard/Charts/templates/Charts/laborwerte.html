{% extends 'Charts/index.html' %}

{% block content %}

<div class="container-fluid" style="background: #ffffff">

  <div class="row" data-row-id="row1" slide-id="slide">
    <div class="col-12">
      <div class="border1">
        <h1>Performance Measure</h1>
        <canvas id="PerformanceMeasure"></canvas>
      </div>
    </div>
  </div>

  <div class="row" data-row-id="row2">
    <div class="col-12">
      <div class="border1">
        <h1>Energy Consumption</h1>
        <canvas id="EnergieConsumption"></canvas>
      </div>
    </div>
  </div>

  <div class="row" data-row-id="row3">
    <div class="col-12">
      <div class="border1">
        <h1>Lab Values</h1>
        <canvas id="LabValues"></canvas>
      </div>
    </div>
  </div>

</div>




<script>
// create initial chart PerformanceMeasure
var performance_measure = {{ performance_measure|safe }}
var performance_measure_time = {{ performance_measure_time|safe }}

const options = {
  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[%]', // Hier kannst du den Namen für die Y-Achse festlegen
        font: {
          size: 16, // Du kannst die Schriftgröße anpassen, wenn gewünscht
        },
      },
    }
  }
};

var ctx_live = document.getElementById("PerformanceMeasure");
var performance_measure_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: performance_measure_time,
    datasets: [{
      data: performance_measure,
      borderWidth: 2,
      radius: 0,
      borderColor:'rgba(255, 99, 132, 1)',
      label: 'Performance Measure',
      tension: 0.25,
      //fill: {
      // target: 'origin',
        //below: 'rgba(255, 99, 132, 0.2)',
        //above: 'rgba(4, 216, 14, 0.2)'
      //}, 
    }]
  },
  options: options,
});


///////////////////////////////////////////////////////////////////////////////////////////////


// create initial chart Energieverbrauch
var energyConsumption = {{ energy_consumption|safe }}
var energyConsumptionTime = {{ energy_consumption_time|safe }}

var numberElements = 12;
var updateCount = 61;


const options2 = {
  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
      title: {
        display: true,
        text: '[kW]', // Hier kannst du den Namen für die Y-Achse festlegen
        font: {
          size: 16, // Du kannst die Schriftgröße anpassen, wenn gewünscht
        },
        position: 'top',
      },
    }
  }
};

var ctx_live = document.getElementById("EnergieConsumption");
var energieConsumptionChart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: energyConsumptionTime,
    datasets: [{
      data: energyConsumption,
      borderWidth: 2,
      radius: 0,
      borderColor:'rgba(255, 99, 132, 1)',
      label: 'Energy Consumption',
      tension: 0.25,
      //fill: {
      // target: 'origin',
        //below: 'rgba(255, 99, 132, 0.2)',
        //above: 'rgba(4, 216, 14, 0.2)'
      //}, 
    }]
  },
  options: options2,
});




///////////////////////////////////////////////////////////////////////////////////////////////


// create initial chart LaborWerte
var meineDaten = {{ area_weights|safe }}
var meineDaten2 = {{ area_weight_time|safe }}


const options5 = {
  maintainAspectRatio: false,
  responsive: true,
  legend: {
    display: true,
  },
  legend: {
    display: false
  },
  scales: {
    x: {
      beginAtZero: true,
      drawBorder: false,
    },
    y: {
      position: 'right',
      beginAtZero: true,
      type: 'linear',
      grid: {
        drawBorder: false,
        color: (context) => {
        if(context.tick.value === 0) {
            return 'black'
        }
        } 
      },
      beginAtZero: false,
      suggestedMin: 0,
      suggestedMax: 0,
            title: {
  display: true,
  text: '[g/m^2]', // Hier kannst du den Namen für die Y-Achse festlegen
  font: {
    size: 16, // Du kannst die Schriftgröße anpassen, wenn gewünscht
  },
},
    }
  }
};

var ctx_live = document.getElementById("LabValues");
var area_weight_chart = new Chart(ctx_live, {
  type: 'line',
  data: {
    labels: meineDaten2,
datasets: [
  {
    data: meineDaten[0],
    borderWidth: 2,
    radius: 0,
    borderColor: 'rgba(255, 99, 132, 1)',
    label: 'Area Weight min',
    tension: 0.25,
  },
  {
    data: meineDaten[1],
    borderWidth: 2,
    radius: 0,
    borderColor: 'rgba(4, 216, 14, 1)',
    label: 'Area Weight max',
    tension: 0.25,
  },
  {
    data: meineDaten[2],
    borderWidth: 2,
    radius: 0,
    borderColor: 'rgba(0, 0, 255, 1)',
    label: 'Area Weight median',
    tension: 0.25,
  },
]
  },
  options: options5,
});









// logic to get new data for '1h' chart
var getData1 = function() {
  
  $.ajax({
    type: "GET",
    url: "/Charts/updateChartOneMinute",
    success: function(data) {
      var _data_performance=data[0];
      var _data_energy=data[1];
      var _data_area_max=data[2];
      var _data_area_min=data[3];
      var _data_area_median=data[4];

      var now = new Date();
      var time = now.toLocaleTimeString();

      // Updating Performance
      performance_measure_chart.data.labels.push(time);
      performance_measure_chart.data.datasets[0].data.push(_data_performance);
      
      performance_measure_chart.data.labels.shift();
      performance_measure_chart.data.datasets[0].data.shift();
  
      performance_measure_chart.update('none');


      // Updating Energieverbrauch
      energieConsumptionChart.data.labels.push(time);
      energieConsumptionChart.data.datasets[0].data.push(_data_energy);

      energieConsumptionChart.data.labels.shift();
      energieConsumptionChart.data.datasets[0].data.shift();

      energieConsumptionChart.update('none');


       // Updating AreaWeight
      area_weight_chart.data.labels.push(time);
      area_weight_chart.data.datasets[0].data.push(_data_area_max);
      area_weight_chart.data.datasets[1].data.push(_data_area_max);
      area_weight_chart.data.datasets[2].data.push(_data_area_max);

      area_weight_chart.data.labels.shift();
      area_weight_chart.data.datasets[0].data.shift();
      area_weight_chart.data.datasets[1].data.shift();
      area_weight_chart.data.datasets[2].data.shift();

      area_weight_chart.update('none');

    }
  });
};

updateCanvas = setInterval(getData1, 60000);


</script>

{% endblock %}


